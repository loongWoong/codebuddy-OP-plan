以下计划将“指标管理系统”拆解为 4 个阶段、17 个里程碑（M0-M16），每个里程碑明确：

• 前置依赖  
• 生成内容清单（可直接喂给大模型）  
• 完成标准（Definition of Done，DoD）  
• 预计代码量 / 文档页数（供进度跟踪）

整体节奏：13 周（≈ 3 个月），按周迭代，可并行任务已标★。  

────────────────  
阶段 0　项目初始化（1 周）  
M0  环境 & 脚手架  
 前置：无  
 生成内容  
  - datart-fork 仓库初始化脚本（含 indicator 模块空壳）  
  - docker-compose.dev.yml（MySQL + Redis + datart-dev）  
  - README.md（开发、调试、提交规范）  
  - branch strategy：main / dev / feature/**  
 DoD：本地一键 `make dev` 启动，空模块编译通过  
 代码量：≈ 200 行脚本 + 5 页文档  

────────────────  
阶段 1　元数据 & 基础框架（2 周）  
M1  元数据 ER 设计  
 前置：M0  
 生成内容  
  - docs/ER-indicator.md（完整 ER 图、字段说明、索引）  
  - Liquibase changelog v0.1（含 8 张表）  
 DoD：changelog 在空库执行成功，diff 检查 0 error  
 代码量：1 个 XML + 3 页文档  

M2  后端实体 & Repository ★  
 前置：M1  
 生成内容  
  - entity/*.java（JPA）  
  - repository/*.java（Spring Data）  
  - BaseIndicatorService.java（CRUD 模板）  
 DoD：单元测试覆盖 80%，无 Lombok 注解警告  
 代码量：≈ 30 个类 / 1 k 行  

M3  通用错误码 & 权限扩展 ★  
 前置：M0  
 生成内容  
  - exception/IndicatorException.java  
  - constant/IndicatorErrorEnum.java  
  - security/IndicatorPermissionEvaluator.java  
 DoD：原有权限测试用例全部通过，新增 3 条用例通过  
 代码量：≈ 10 个类 / 300 行  

────────────────  
阶段 2　维度与维表（3 周）  
M4  维表管理 API  
 前置：M2  
 生成内容  
  - DimensionTableController.java（REST）  
  - DimensionTableService.java（含同步数据库表结构）  
  - 单元测试：CRUD + 同步结构  
 DoD：Postman 集合 100% 通过  
 代码量：≈ 5 个类 / 500 行  

M5  维度管理 API  
 前置：M4  
 生成内容  
  - DimensionController.java  
  - DimensionHierarchyService.java（层级拖拽保存）  
  - API 文档（Swagger annotation）  
 DoD：Swagger UI 正常展示，层级 JSON 保存正确  
 代码量：≈ 6 个类 / 600 行  

M6  维表在线编辑 ★  
 前置：M4  
 生成内容  
  - DimensionTableDataController.java（≤1000 行增删改）  
  - 前端组件 DimensionTableEditor.tsx  
 DoD：前端页面可增删改，保存后数据库立即生效  
 代码量：后端 300 行 + 前端 400 行  

M7  自助 ETL 绑定 ★  
 前置：M4  
 生成内容  
  - EtlTaskController.java（增删改查）  
  - Quartz job：IndicatorEtlJob.java（空跑）  
  - 前端 EtlTaskForm.tsx（仅绑定，无 DAG）  
 DoD：任务可触发，日志写入 indicator_etl_log  
 代码量：后端 500 行 + 前端 200 行  

────────────────  
阶段 3　指标与事实表（4 周）  
M8  原子指标 API  
 前置：M5  
 生成内容  
  - AtomicMetricController.java  
  - MetricValidator.java（业务口径正则）  
  - 指标编码生成规则（雪花算法）  
 DoD：单元测试 30 例，编码不重复  
 代码量：≈ 6 个类 / 600 行  

M9  计算指标表达式引擎 ★  
 前置：M8  
 生成内容  
  - service/FormulaEngine.java（Aviator 封装）  
  - service/MetricExpressionParser.java  
  - 测试用例：50 条公式  
 DoD：公式解析无 NPE，平均耗时 <10 ms  
 代码量：≈ 3 个类 / 400 行  

M10 事实表管理 API  
 前置：M5  
 生成内容  
  - FactTableController.java（手动 / 按维度 / 按指标 三种创建）  
  - FactTableBuilder.java（自动建表 SQL 生成）  
 DoD：创建后物理表存在，字段顺序与 ER 一致  
 代码量：≈ 7 个类 / 700 行  

M11 事实表数据灌入 ★  
 前置：M10 & M7  
 生成内容  
  - FactTableDataController.java（在线编辑 + ETL 绑定）  
  - Quartz job：FactEtlJob.java  
 DoD：1000 行内可在线编辑，>1000 行走 ETL  
 代码量：后端 500 行 + 前端 300 行  

M12 指标数据灌入 ★  
 前置：M8 & M11  
 生成内容  
  - MetricDataController.java（绑定 ETL 任务）  
  - 指标 → 事实表字段映射界面 MetricFieldMapping.tsx  
 DoD：映射保存后，ETL 任务可正确灌数  
 代码量：后端 300 行 + 前端 400 行  

────────────────  
阶段 4　模型生成、权限、集成（3 周）  
M13 数据模型生成 API  
 前置：M8 & M10  
 生成内容  
  - IndicatorModelController.generateDataModel()  
  - service/DataModelGenerator.java（创建视图 & 同步到 datart_dataset）  
  - 测试：生成后可在 datart 图表正常选数  
 DoD：Swagger 接口 200，图表能拖拽字段  
 代码量：≈ 5 个类 / 500 行  

M14 权限细粒度控制  
 前置：M3 & M8 & M13  
 生成内容  
  - DimensionPermissionEvaluator.java  
  - MetricPermissionEvaluator.java  
  - 前端权限指令 hasIndicatorPerm.tsx  
 DoD：无权限字段在图表不可见，单元测试 20 例  
 代码量：≈ 4 个类 / 300 行  

M15 前端整合 & 国际化 ★  
 前置：M6 & M11 & M13  
 生成内容  
  - 菜单配置：config/menu.ts 新增 indicator 目录  
  - 页面路由懒加载  
  - i18n 词条 en_US / zh_CN  
 DoD：Chrome Lighthouse 性能 90+，无 warning  
 代码量：≈ 15 个页面 / 2 k 行  

M16 端到端测试 & 文档  
 前置：全部  
 生成内容  
  - docs/user-guide.md（业务人员视角）  
  - docs/dev-guide.md（二次开发视角）  
  - e2e 测试：Cypress 20 条场景  
 DoD：CI 绿灯，覆盖率>75%，文档审阅通过  
 代码量：≈ 1 k 行测试 + 20 页文档  

────────────────  
并行甘特图（周）

周1  周2  周3  周4  周5  周6  周7  周8  周9  周10 周11 周12 周13
M0   █
M1   █
M2      █
M3      █
M4         █
M5            █
M6         █
M7            █
M8               █
M9               █
M10                 █
M11                 █
M12                    █
M13                    █
M14                       █
M15                          █
M16                             █

────────────────  
大模型代码生成节奏控制

1. 每周一上午由 PM（人）提交本里程碑 prompt（含前置依赖 + 生成清单）。  
2. 大模型一次只生成一个里程碑内容，避免跨层依赖。  
3. 生成后自动触发 GitHub Action：  
   • compile + unit test ≤ 3 min  
   • 若失败，回滚 commit，人工调整 prompt 再重试。  
4. 每周五下午 Code Review，通过即合并到 dev 分支，否则打回。  

────────────────  
完整程度检查单（每一里程碑必须附带的交付物）

☐ Java 源码（含 package-info.java）  
☐ 单元测试（JUnit 5 + AssertJ）  
☐ REST API 文档（Swagger/OpenAPI 注解）  
☐ 前端组件（TypeScript + React Hooks）  
☐ 数据变更脚本（Liquibase）  
☐ README（含如何本地启动 & 调试）  
☐ 截图或 GIF（前端页面效果）  

以上清单未全部打勾，该里程碑视为未完成。