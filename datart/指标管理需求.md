
一、概念说明
事实表：事实表是一种数据表，存储有事实记录的表，如系统日志、销售记录等。
原子指标：含义与度量相同：是业务定义中不可再拆分的指标，具有明确业务含义的名词，如：支付金额、客单价、销售数量。
计算指标：是基于原子指标通过四则运算或结合条件而产生的一类指标，如：“不良贷款率=不良贷款/贷款总额*100%”。该类指标不需要将数据结果存储到指标存储库中，只在前端计算结果展现即可。
维表：维表是一种数据表，保存了维度的属性值，如日期维表（存储与日期维度对应的年、月、日等属性值）、地理维表（存储国家、省／州、城市等属性值）等。
维度：维度是观察事物/描述事实的角度，比如日期维度，包括“年”、“月”、“日”等；地理维度，包括“省”、“市”等；机构维，包括“财务部”、“研发部”等；
度量：度量通常是数值信息，比如销售、价格、成本等。这些数值是可以进行计算的，例如求和，求平均，求最大值等。

二、功能操作
IT对指标进行了一系列的梳理、处理、创建等，构建了完整的指标体系，并存储在指标库中。指标库相当于在上游数据源和下游数据消费之间搭建了桥梁，不仅能够灵活地进行数据变更，同时将一致且正确的数据提供给各种下游消费者使用。

指标管理提供一站式指标管理服务，它通过一个平台覆盖了指标管理从定义、建模、调度、发布、使用的全过程。本文将介绍指标模型的基本使用流程。指标模型使用流程如下图所示：


1、创建指标模型 —— 定义业务领域范围
2、定义维表
a)维度类型：普通维、日期维
b)创建方式：新建表、基于数据库表创建、SQL查询创建
c)灌数据：手动填入数据、定义ETL任务进行灌数据
3、创建维度：
a)添加字段
b)关联维表
c)定义层级
4、定义指标：
a)业务属性 —— 基本信息，业务口径
b)维度设置 —— 选择可用维度
c)存储设置 —— 选择来源表和来源字段
d)数据管理 —— 进行灌数据
5、使用指标模型 —— 生成数据模型

三、功能说明
4.1、创建指标模
点击“指标模型”后，弹出 新建指标模型 窗口，填写指标模型相关信息。

指标存储库：是用于存储指标模型的数据库，存储指标的物理表结构及数据。所以，我们在新建一个指标模型时，应指定一个指标模型存储的数据库。
单击 确定 按钮，完成指标模型节点创建。


4.2、创建维表
4.2.1、新建维表的表结构
维表包含两种类型：
1.普通维表
2.日期维表
4.2.1.1、系统新建表
1、点击数据准备，进入已创建指标模型，选择存储管理，选择维表，点击新建一种维表类型，包括普通维表、日期维表。
2、点击一种维表类型，如“普通维表”，跳转到“新建维表”界面。
普通维表各功能说明如下：
维表结构
名称：输入维表字段的名称，该名称是维字段在物理表中表字段的名称。
别名：输入维表字段的别名，该名称是维字段在物理表中表字段的别名。
数据类型：选择维表字段的数据类型。
数据格式：选择维表字段的数据格式。
主键：设置维表字段是否是主键，一张维表有且仅有一个主键。
允许为空：设置维表字段的数据是否允许为空。

如新建 日期维表 ，跳转到“新建维表”界面。

名称: 输入维表的名称，该名称是维表在指标库中对应的物理表的别名。
表名: 输入维表表的名称，该名称是维表在指标库中对应的物理表的名称。
开始日期/结束日期: 选择开始及结束日期，格式为”YYYY-MM-DD“。
日期字段名: 输入日期维表主键字段名，主键字段数据格式为”YYYY-MM-DD“。
时间频度: 勾选时间频度，系统自动生成该频度字段及数据。
自定义字段名: 根据勾选的时间频度显示字段名的输入框。

4.2.1.2、添加数据库的表
1、进入已创建指标模型，选择存储管理，选择维表，点击 添加 > 数据源表 。

2、进入到“添加数据源表”的界面，可批量从左侧添加多张表到右侧选框内。
添加表的范围：指标存储库关联的数据源下的表。
可添加多个Schema下的表。
 3、点击 保存 ，若添加的维表中无唯一主键字段，则会进入“设置维表主键”界面。
配置维表主键是为后续生成数据模型时，默认选择哪个字段和事实表关联。
4、由“添加数据源表”新建的维表，表结构统一在数据库中维护，系统支持从数据库中同步最新的表结构到指标模型中。

4.2.1.3、添加SQL查询
1、进入已创建指标模型，选择 存储管理，选择 维表，点击 添加 > SQL查询 。
2、进入“新建SQL查询”界面，编写SQL后，点击工具栏上的 保存 。
3、将SQL查询结果作为维表结构，输入名称和设置主键字段，点击 保存 ，完成维表的创建。
4、由“SQL查询”新建的维表，可通过 编辑SQL查询 更新维表结构。
4.2.2、实现维表的表数据
新建维表的表结构后，再实现维表的表数据 有两种方式实现表数据，分别是：在线编辑数据、通过绑定自助ETL实现灌数。
4.2.2.1、在线编辑数据
打开某个维表，点击 数据预览 ，查看维表数据。

点击右侧的 在线编辑 ，打开在线编辑数据的窗口。

可以对某一个数据行进行操作，目前暂时只支持小数据量的场景，默认限制表数据小于等于1000行时，才能进行在线编辑。
PS：在线编辑的数据对象是指标存储库中的数据，不会影响源业务系统数据。

4.2.2.2、绑定自助ETL(此处预留与第三方ETL系统对接的接口即可)
选择维表，新建自助ETL。如已创建自助ETL，则对应的选择自助ETL即可。维表已绑定自助ETL后，支持 打开自助ETL 进行修改，或 重新绑定 或 解除绑定 自助ETL。
4.3、创建维度
4.3.1、新建入口
创建指标模型后，会自动增加模型目录节点，点击维度 新建，新建维度类型包括普通维、日期维、地理维。如下图所示：

普通维：表示实际的业务维度，如产品类别、产业类别、币种等；
日期维：表示通用的日期维度，如年、季、月、日等；
地理维：表示通用的地理维度，如国家、省份、市区等
4.3.2、新建维度
维度设置
点击需创建的维度类型后，如点击 普通维 ，页面跳转到“新建维度”界面。

名称：维度的名称，如“产品维”。建议使用中文、英文，不允许包含非法字符“\/'|"*?%.><=:;()[]”。
描述：维度的描述，如“产品维是指不同产品类型，包括饮料、谷物、水产等”。添加完整、准确的维度信息说明，可让使用者更清楚了解维度。
维度属性名称：维度属性的名称，比如“产品大类、产品小类”。建议使用中文、英文，不允许包含非法字符“\/'|"*?%.><=:;()[]”。
地理维度：在维度属性上标记地理信息。地理维度类型：区域、经度、纬度。地理维度功能仅在地理维中才支持。
选择维表：设置维度的数据存储，仅支持选择当前指标模型中“维表”节点下的资源。

维度关联维表和维表字段
普通维、地理维、日期维都需要关联相应的维表，最终维度的数据是存储在对应维表中。如下图，选择对应维表，并且关联对应字段。此操作需要一定的IT技术，建议由IT人员完成。

设置维度层次
维度层次：是描述维度内部结构的属性集合，它刻画了维度内部不同成员间的相对关系。维度可以有其自身的维度层次结构。比如时间维，可以有“年--季度--月份”的层次；地理维，可以有“省份--城市--街道”的层次；产品维，可以有“产品类别--品牌--产品名”的层次。
可通过“层次结构管理”设置维度层次，主要用于在数据分析展现时，实现维度钻取、时间计算等。如维度层次实现了在自助仪表盘中的上钻或下钻。
普通层次结构
1、适用于普通维和地理维，创建层次结构的入口：

2、点击 层次结构管理 ，在弹出窗口中拖拽维度属性生成层次结构，一个维度支持生成多个层次结构。
拖拽维度属性到空白处生成新层次结构。
拖拽维度属性到“<新级别>”中，在已有层次结构中生成新的层级。

3、层次结构操作包含：修改层次结构名称（默认层次结构名称为“新层次”，为保证层次结构不重名，必须修改默认层次结构名称。）、层级名称、调整顺序等。
4、支持设置生成/同步数据模型时，是否在报表上隐藏维度，只保留层次结构。此功能可减少相同业务含义的维度和层次结构重复出现。

修改维度
已创建的维度可以修改：维度名称、维度属性、关联维表、关联字段等。

删除维度
删除已建维度的操作如下：

维度授权
维度授权支持“批量授权”和“个别授权”：
批量授权：对维度目录授权，并将权限传播到子对象，这样该目录及目录下的维度都将被授权。
个别授权：对指定维度进行授权。
维度目录和维度授权操作如下：
在“维度”目录节点或某维度的更多菜单中选择 资源授权，进入当前维度目录或维度的授权界面。





4.4、创建指标
4.4.2、新建指标
新建指标前，需要明确指标的类型，所以需要先新建指标分类。

然后，新建指标。在“指标管理”界面，单击 新建指标 按钮，或在指标分类目录更多菜单选择 新建 > 指标。


设置指标业务属性
业务属性在审核流程中由业务人员设置，用于设置指标的业务属性。

指标分类：选择指标所属的指标分类
指标编码：由系统自动生成，如A_SALE_0000074 
指标名称：输入指标名称。
指标类型：选择指标类型：原子指标、计算指标。默认为：原子指标。
汇总依据：选择指标的汇总依据：合计、最大值、最小值、平均值、计数、唯一计数。默认为：合计。
指标状态：选择指标的状态：启用、禁用。默认为：启用。
数据频度：帮助技术人员确定取数的时间结点；可选项有：年、季、月、周、日。
提出人：输入指标的提出人。
业务口径：输入指标的业务口径。

设置指标维度
维度设置在审核流程中由业务人员设置，用于选择指标所依赖的维度。该步骤为创建指标必选步骤。

设置指标存储
存储设置在审核流程中由数管中心人员设置，用于设置指标所属的事实表及对应字段。该步骤为创建指标必选步骤。


指标数据灌入
数据管理在审核流程中由数管中心人员设置，用于绑定实现指标灌数的自助ETL。
该步骤为创建指标可选步骤，若该步骤在创建指标时未操作，则需要在创建事实表后通过数据管理功能来实现事实表灌数。

4.4.3、指标概览
完成新建指标后，可以查看指标的相关信息，在指标列表操作栏中单击 概览：



4.4.4、指标搜索
查看所有指标列表，支持通过编码或名称关键字搜索相关指标。

4.4.5、指标导入和导出
导入指标是通过导入指标文件指创建指标。
单击 导入指标 按钮，在弹出的下拉菜单中选择 导入指标 导入指标文件即可。
若没有指标文件，可以先 下载模板，在模板中把指标属性定义好再导入该文件。

4.4.6、指标溯源
指标溯源是指当前指标关联的维度、事实表及指标分类，操作如下：
1、在指标列表操作栏中单击 溯源：
2、弹出当前指标的“元数据分析”窗口，查看“血统分析”。
      在列表资源中双击，可以打开维度资源、事实表资源的管理界面查看。

影响性分析则展示的是当前指标所应用的引用。

4.4.7、指标授权
指标除了通过继承指标分类的资源权限实现批量授权外，还可以对单个指标进行授权，操作如下：
1、在指标列表中的指标所属行区任意位置右键单击，弹出右键菜单，选择 资源授权：

2、进入当前指标授权界面：


4.5、使用指标模型
4.5.1、生成数据模型
根据具体业务情况勾选所需的指标和维度生成对应数据模型，数据模型之间相互独立，业务用户可基于数据模型进行指标数据分析。
1、操作入口，在指标模型下的”模型管理“节点，在其更多菜单中选择新建命令菜单。


2、单击“新建 > 数据模型”，打开新建数据模型界面。勾选指标，右侧自动显示勾选指标关联的维度。

公共维度：是指所有勾选的指标都关联的维度，且默认勾选全部公共维度。
私有维度：当勾选的指标中，存在至少一个指标不关联该维度时，则为私有维度。私有维度默认不勾选。

3、点击 保存 生成数据模型后，在“模型管理”节点下生成对应数据模型，可直接双击打开数据模型查看转化后的数据模型结果。

4.5、创建事实表
4.5.1、新建事实表的表结构
4.5.1.1、系统新建表
1、进入已创建指标模型，选择 存储管理，选择 事实表，点击 新建 ，系统支持三种方式新建事实表：根据指标新建、根据维度新建、手动新建。
根据指标新建
根据指标新建事实表前提：已经创建好全部或部分指标。使用根据指标新建事实表时，事实表自动包含选取的指标及指标依赖的维度。
1、在“选择指标”窗口，勾选指标：显示所有未被事实表关联的指标。
2、系统生成包含勾选指标及指标依赖维度的事实表，用户在此基础上创建其它指标及维度。

根据维度新建
根据维度新建事实表前提：已经创建好全部或部分维度。
使用根据维度新建事实表时，事实表自动包含选取的维度。
1、在“选择维度”窗口，勾选维度：
2、系统生成包含勾选维度的事实表，用户在此基础上创建其它指标及维度。
手动新建
若指标和维度都没有创建的情况下，通过手动新建事实表。手动新建的事实表是一个空白的表，需要用户手动添加指标和维度。

4.5.1.2、添加数据库的表
1、进入已创建指标模型，选择 存储管理，选择 事实表，点击 添加 > 数据源表 。
2、进入到“添加数据源表”的界面，可批量从左侧添加多张表到右侧选框内。
添加表的范围：指标存储库关联的数据源下的表
可添加多个Schema下的表。
4.5.1.3、添加SQL查询
1、进入已创建指标模型，选择 存储管理，选择 事实表，点击 添加 > SQL查询 。

2、进入“新建SQL查询”界面，编写SQL后，点击工具栏上的 保存 。

3、将SQL查询结果作为事实表结构，输入名称后点击 保存 ，完成事实表的创建。

4、由“SQL查询”新建的事实表，可通过 编辑SQL查询 更新事实表结构。

4.5.2、实现事实表的表数据
4.5.2.1、在线编辑数据
1、打开某个事实表，点击 数据预览 ，查看事实表数据。


 2、点击右侧的 在线编辑 ，打开在线编辑数据的窗口。
      ●   目前暂时只支持小数据量的场景，默认限制表数据小于等于1000行时，才能进行在线编辑。
      ●   表格数据默认是至少显示100行，如果表数据本身没有达100行时，会自动在数据下面增加空行补齐。
      ●   表格列是根据当前事实表的字段自动显示，不支持增删列。
      ●   默认会自动是冻结列头。


4.5.2.2、绑定自助ETL
1、事实表未绑定自助ETL前：若已经创建了事实表灌数的自助ETL，则直接选择自助ETL绑定即可；若还未创建事实表灌数的自助ETL，则需要新建自助ETL实现绑定。

2、事实表已经绑定自助ETL：支持打开自助ETL进行修改、重新绑定自助ETL或解除绑定操作。

五、总结与思考
5.1、维表和维度
将维表和维度分开，维表作为存储维度数据的载体，创建维度时需要关联维表。一张维表可以关联多个维度。
维表侧重点在于维护维度数据来源；维度除了数据之外，还包括数据之间的结构关系，以及与指标的关联关系。

5.2、维度和指标的关系
创建指标时，也是会先去设置维度，跟亿信华辰相同，维度是作为指标的属性来走的。

5.3、指标管理与数据存储
维表和指标都是在数据存储层创建新的表，然后通过底层ETL能力去向表中灌数据，来构成数据模型的。当使用数据模型时，都是直接访问的数据存储层中的数据。

5.4、多表关联
	产品中未提及多表关联是如何设置的。猜测实在数据模型构建的时候指定的。

5.5、关于事实表
个人理解跟亿信华辰的主题表概念相似。在创建指标时，第三步的存储设置中，需要填入事实表。也就是说指标的数据是来源于事实表的。

5.6、数据频度
	在创建指标时选择的数据频度，跟亿信华辰中的数据期应该是相同的概念，都是为了确定取数的时间结点。